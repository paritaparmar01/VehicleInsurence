{% if check == True %}
    <center><h1 style="color: green;">Data Submitted successfully.</h1></center>
    {% endif %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>New Policy Issue</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body>
    {% comment %} <div class="container mt-4">
        <div class="input-group mb-3">
            <input type="text" class="form-control" placeholder="Enter Phone Number to Search" id="searchInput">
            <button class="btn btn-outline-secondary" type="button" onclick="searchPhoneNumber()">Search</button>
        </div>
    </div> {% endcomment %}
    {% comment %} {% if 'isLoggedin' not in request.session %}
        <script>window.location.href = "/login/";</script>
    {% endif %} {% endcomment %}

    
       
    <div class="container mt-4">
        <div class="row">
            <div class="col-md-6 mb-3">
                <div class="input-group">
                    <input type="text" class="form-control" placeholder="Enter Phone Number to Search" id="searchInput">
                    <button class="btn btn-outline-secondary" type="button" onclick="searchPhoneNumber()">Search</button>
                </div>
            </div>
            <div class="col-md-6 d-flex justify-content-end">
                <button type="button" class="btn btn-primary me-2" data-bs-toggle="modal" data-bs-target="#exampleModal">New Policy Issue</button>
                <button type="button" class="btn btn-success" onclick="downloadDataRecords()">
                    <i class="bi bi-download"></i> Download
                </button>
            </div>
        </div>
    </div>

<!-- Modal -->
<div class=" modal fade row justify-content-end" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-dialog-end col-md-6">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Policy Issue Form</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        
        
    <form "card my-3"  action="/policyissue/"  method="POST" enctype="multipart/form-data">
        {% csrf_token %}
	<div class="container">
        <div class="row align-items-start mt-5 fw-bold">
            <div class="col-md-9 offset-md-2">
                    <div class="mb-3">
                        <label for="exampleInputNumber" class="form-label"><b>Date</b></label>
                        <input type="date" name="date" class="form-control" id="exampleInputDate" onchange="setDefaultDate()">
                    </div>
                    <script>
                        function setDefaultDate() {
                            var currentDate = new Date();
                            var day = currentDate.getDate();
                            var month = currentDate.getMonth() + 1; // Months are zero-based
                            var year = currentDate.getFullYear();
                    
                            // Format the date as 'YYYY-MM-DD' for the input field
                            var formattedDate = year + '-' + (month < 10 ? '0' : '') + month + '-' + (day < 10 ? '0' : '') + day;
                    
                            document.getElementById('exampleInputDate').value = formattedDate;
                        }
                    
                        // Call the function on page load to set the default date
                        window.onload = setDefaultDate;
                    </script>
                    <div class="mb-3">
                        <label for="name" class="form-label">Name</label>
                        <input type="text" class="form-control" id="name" name="name" required>
                    </div>
                    <div class="mb-3">
                        <label for="number" class="form-label">Number</label>
                        <input type="text" class="form-control" id="number" name="number" required>
                    </div>
	                <div class="mb-3">
                    <label for="exampleInputNumber" class="form-label">Policy Number<span class="text-danger">*</span></label>
                                <input type="text" name='p_number' class="form-control" required>
                    </div>
                    <div class="mb-3">
                        <label for="exampleInputNumber" class="form-label">Vehicle Number<span class="text-danger">*</span></label>
                        <input type="text" name='v_number' class="form-control" required>
                    </div>
                    <div class="mb-3">
                        <label for="exampleInputNumber" class="form-label">Vehicle</label>
                        <input type="text" name='Vehicle' class="form-control" required>
                    </div>
                    <div class="mb-3">
                        <label for="exampleInputNumber" class="form-label">Chassis Number</label>
                        <input type="text" name='c_number' class="form-control" required>
                    </div>
                        <div class="mb-3">
                            <label for="exampleInputNumber" class="form-label">Engine Number</label>
                            <input type="text" name='e_number' class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label for="exampleInputEmail1" class="form-label">Location</label>
                            <input type="text" name='Location' class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label for="exampleInputEmail1" class="form-label">HP Bank</label>
                            <input type="text" name='HP_bank' class="form-control" required>
                        </div>
                    <p class='mb-3  fw-bold'>Business Type</p>
                    <div class='row container mx-2'>
                             <div class="col-4 form-check mx-5">
                                <input class="form-check-input" type="radio" name="business_type" id="New" value="New">
                                <label class="form-check-label" for="New">New</label>
                            </div>
                        <div class="col-4 form-check mx=5">
                            <input class="form-check-input" type="radio" name="business_type" id="Data" value="Data" checked>
                            <label class="form-check-label" for="Data">Data</label>
                        </div>
                         <div class="col-4 form-check mx-5">
                            <input class="form-check-input" type="radio" name="business_type" id="Renewal" value="Renewal">
                            <label class="form-check-label" for="Renewal">Renewal</label>
                        </div>
                        <div class="col-4 form-check mx-5">
                             <input class="form-check-input" type="radio" name="business_type" id="Endorsement" value="Endorsement" checked>
                            <label class="form-check-label" for="Endorsement">Endorsement</label>
                         </div>
                    </div>

                    <p class='mt-3 mx-5 fw-bold'>Insurance Type</p>
                    <div class='row container mx-2'>
                        <div class="col-4 form-check mx-5">
                            <input class="form-check-input" type="radio" name="insurance_type" id="Full" value="Full">
                            <label class="form-check-label" for="Full">Full</label>
                        </div>
                        <div class="col-4 form-check mx-5">
                            <input class="form-check-input" type="radio" name="insurance_type" id="TP" value="TP" checked>
                            <label class="form-check-label" for="TP">TP</label>
                        </div>
                        <div class="col-4 form-check mx-5">
                            <input class="form-check-input" type="radio" name="insurance_type" id="SOD" value="SOD">
                            <label class="form-check-label" for="SOD">SOD</label>
                        </div>
                        <div class="col-4 form-check mx-5">
                            <input class="form-check-input" type="radio" name="insurance_type" id="Package" value="Package" checked>
                            <label class="form-check-label" for="Package">Package</label>
                        </div>
                        <div class="col-2 form-check mx-5">
                            <input class="form-check-input" type="radio" name="insurance_type" id="Health" value="Health" checked>
                            <label class="form-check-label" for="Health">Health</label>
                        </div>
                    </div>
                    
                    <p class='mt-3 mx-5 fw-bold'>Insurance Portal</p>
                    <div class='row container mx-2'>
                        <div class="col-4 form-check mx-5">
                            <input class="form-check-input" type="radio" name="insurance_portal" id="Mintpro" value="Mintpro">
                            <label class="form-check-label" for="Mintpro">Mintpro</label>
                        </div>
                        <div class="col-3 form-check mx-5">
                            <input class="form-check-input" type="radio" name="insurance_portal" id="Agency" value="Agency" checked>
                            <label class="form-check-label" for="Agency">Agency</label>
                        </div>
                        <div class="col-4 form-check mx-5">
                            <input class="form-check-input" type="radio" name="insurance_portal" id="Ahmedabad" value="Ahmedabad">
                            <label class="form-check-label" for="Ahmedabad">Ahmedabad</label>
                        </div>
                        <div class="col-3 form-check mx-5">
                            <input class="form-check-input" type="radio" name="insurance_portal" id="IRSS" value="IRSS" checked>
                            <label class="form-check-label" for="IRSS">IRSS</label>
                        </div>
                        <div class="col-4 form-check mx-5">
                            <input class="form-check-input" type="radio" name="insurance_portal" id="Probus" value="Probus" checked>
                            <label class="form-check-label" for="Probus">Probus</label>
                        </div>
                        <div class="col-4 form-check mx-5">
                            <input class="form-check-input" type="radio" name="insurance_portal" id="Insurance_Dekho" value="Insurance_Dekho" checked>
                            <label class="form-check-label" for="Insurance_Dekho">Insurance_Dekho</label>
                        </div>
                    </div>
                    <style>
                        .form-container {
                            margin: 20px;
                            padding: 20px;
                            border: 1px solid #ccc;
                            border-radius: 5px;
                        }
                
                        .autocomplete {
                            position: relative;
                            display: inline-block;
                            margin-bottom: 15px;
                        }
                
                        input {
                            padding: 10px;
                            width: calc(100% - 20px);
                            margin-bottom: 10px;
                        }
                
                        .autocomplete-items {
                            position: absolute;
                            border: 1px solid #ccc;
                            max-height: 150px;
                            overflow-y: auto;
                            z-index: 99;
                            width: calc(100% - 20px);
                        }
                
                        .autocomplete-item {
                            padding: 10px;
                            cursor: pointer;
                        }
                
                        .autocomplete-item:hover {
                            background-color: #e0e0e0;
                        }
                
                        /* Add style for the button */
                        .add-button {
                            cursor: pointer;
                            background-color: #4caf50;
                            color: white;
                            border: none;
                            border-radius: 5px;
                            padding: 10px;
                            width: calc(25% - 20px);
                        }
                
                        /* Adjusted styling for better visibility */
                        .add-button:hover {
                            background-color: #45a049;
                        }
                
                        /* Style for the plus sign */
                        .add-company-input::before {
                            content: '\002B'; /* Unicode character for plus sign */
                            position: absolute;
                            padding: 10px;
                            color: #ccc;
                            cursor: pointer;
                        }
                    </style>
                </head>
                <body>
                    <div class="form-container col-10 mb-1 mx-2 mt-4 mx-5">
                        <label for="exampleInputEmail1" class="form-label">Insurance Company</label>
                        <div class="mb-3">
                            <input type="text" name='I_company' id="insurance-company-input" class="form-control px-5" required>
                            <div class="autocomplete-items" id="insurance-company-list"></div>
                        </div>
                        <div class="mb-3">
                            <input type="text" id="new-company-input" placeholder="+ Enter new company name">
                        </div>
                        <button class="add-button col-10 mb-1 mx-2 mt-4 mx-5" onclick="addCompany()">Add Company</button>
                    </div>
                
                    <script>
                        // List of insurance companies
                        const insuranceCompanies = ["BAJAJ", "ICICI LOMBARD", "TATA AIG", "BAJAJ", "LIBERTY", "BAJAJ(MINTPRO)",
                            "GO DIGIT(MINTRO)", "HDFC MINTPRO", "BARTI AXXA", "HDFC(MINTPRO)", "HDFC ERGO", "ROYAL IRSS",
                            "GO DIGIT MINTPRO", "BAJAJ MINTPRO", "IRSS TATA AIG", "ROYAL SUNDRAM", "BAJAJ ALLIANZ",
                            "BHARATI AXXA", "RELIANCE(MINTPRO)", "TATA AIG(IRSS)", "HDFC MINTRO", "FG MINTPRO", "HDFC AMD",
                            "TATA AIG IRSS", "PROBUS FG", "PROBUS GO DIGIT", "PROBUS BAJAJ", "MINTPRO BAJAJ", "PROBUS ICICI",
                            " PROBUS RELIANCE", "PROBUS HDFC", "THE NEW INDIA", "MINTPRO ROYAL", "PROBUS AXXA", "PROBUS TATA",
                            "MINTPRO IFKO TOKIO", "PROBUS BHARTI AXXA", "TATA IRSS", "MINTPRO GO DIGIT", "AMD HDFC", "IRSS FG",
                            "PROBUA BHARTI", "TATA ANAND", "ROYAL TATA", "PROBUS LIBERTY", "GO DIGIT PROBUS", "RELIANCE PROBUS",
                            "BAJAJ PROBUS", "ICICI MINTPRO", "ROYAL", "KOTAK MAHINDRA", "RELIANCE", "RELIANCE MINTPRO",
                            "HDFC PROBUS", "GO DIGIT", "FG", "NIVA BUPA", "KOTAK", "HDFC ERGO MARUTI", "UNIVERSAL SOMPO",
                            "CHOLA MS", "NATIONAL INSURANCE", "SHRIRAM", "IFKO TOKIO", "ICICI", "HDFC ONLINE", "EDELWEISS",
                            "ROYAL", "HDFC", "DIGIT", "OFFLINE HDFC ERGO", "DIGIT", "RAHEJA", "OFFLINE RELIANCE", "OFFLINE IFKO",
                            "GO DIGIT OFFLINE", "ACKO", "IFCKO", "RELIANCE OFFLINE", "HDFC", "OFFLINE CHOLA MS", "OFFLINE TATA AIG",
                            "TATA AIG OFFLINE", "TATA", "CHOLA", "IFCKO OFFLINE", "ZUNO OFFLINE", "BAJAJ OFFLINE", "IFCKO",
                            "TATA OFFLINE", "SHRIRAN OFFLINE", "ZUNO", "MAGMA", "SBI OFFLINE", "HDFC OFFLINE", "ZUNO"];
                
                
                        // Get the input element and the list container
                        const inputElement = document.getElementById('insurance-company-input');
                        const listContainer = document.getElementById('insurance-company-list');
                        const newCompanyInput = document.getElementById('new-company-input');
                
                        // Event listener for input changes
                        inputElement.addEventListener('input', function() {
                            const inputText = this.value.toLowerCase();
                            // Clear previous items
                            listContainer.innerHTML = '';
                
                            // Filter and display matching items
                            const matchingCompanies = insuranceCompanies.filter(company => company.toLowerCase().includes(inputText));
                            matchingCompanies.forEach(company => {
                                const itemElement = document.createElement('div');
                                itemElement.className = 'autocomplete-item';
                                itemElement.textContent = company;
                                itemElement.addEventListener('click', function() {
                                    inputElement.value = company;
                                    listContainer.innerHTML = '';
                                });
                                listContainer.appendChild(itemElement);
                            });
                        });
          
                        // Function to add a new company to the list
                        function addCompany() {
                            const newCompany = newCompanyInput.value.trim().toUpperCase();
                
                            // Check if the company is not empty and does not already exist
                            if (newCompany !== '' && !insuranceCompanies.includes(newCompany)) {
                                insuranceCompanies.push(newCompany);
                                newCompanyInput.value = ''; // Clear the input field
                            }
                
                            // Update the autocomplete list
                            updateAutocomplete();
                        }
                
                        // Function to update the autocomplete list
                        function updateAutocomplete() {
                            listContainer.innerHTML = '';
                
                            insuranceCompanies.forEach(company => {
                                const itemElement = document.createElement('div');
                                itemElement.className = 'autocomplete-item';
                                itemElement.textContent = company;
                                itemElement.addEventListener('click', function() {
                                    inputElement.value = company;
                                    listContainer.innerHTML = '';
                                });
                                listContainer.appendChild(itemElement);
                            });
                        }
                
                        // Close the list when clicking outside the input
                        document.addEventListener('click', function(event) {
                            if (event.target !== inputElement && event.target !== listContainer) {
                                listContainer.innerHTML = '';
                            }
                        });
                    </script>
                        <div class="mb-3">
                            <label for="exampleInputEmail1" class="form-label">Payment from Customer</label>
                            <input type="text" name='payment' class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label for="exampleInputEmail1" class="form-label">Payment by SOS</label>
                            <input type="text" name='payment_sos' class="form-control" required>
                        </div>
                        <div class="mb-3">
                          <label for="exampleInputEmail1" class="form-label">Policy Start Date<span class="text-danger">*</span></label>
                          <input type="date" name='PS_date' class="form-control" id="start-date" required onchange="setEndDate()">
                      </div>
                      <div class="mb-3">
                          <label for="exampleInputEmail1" class="form-label">Policy End Date<span class="text-danger">*</span></label>
                          <input type="date" name='PE_date' class="form-control" id="end-date" required>
                      </div>
                      
                      <script>
                          function setEndDate() {
                              var startDate = new Date(document.getElementById('start-date').value);
                              
                              // Add 365 days to the start date
                              startDate.setDate(startDate.getDate() + 365);
                              
                              // Format the end date and set it in the end-date input
                              var formattedEndDate = startDate.toISOString().split('T')[0];
                              document.getElementById('end-date').value = formattedEndDate;
                          }
                      </script>
                         
                        <div class="mb-3">
                            <label for="exampleInputEmail1" class="form-label">NCB %</label>
                            <input type="number" name='Ncb' class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label for="exampleInputEmail1" class="form-label">Premium</label>
                            <input type="number" name='Premium' class="form-control" required>
                        </div>
                        <!DOCTYPE HTML>
                        <html lang="en">
                        
                        <head>
                            <meta charset="UTF-8">
                            <meta name="viewport" content="width=device-width, initial-scale=1.0">
                            <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
                                rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
                                crossorigin="anonymous">
                            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
                                integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
                                crossorigin="anonymous"></script>
                            <style>
                                body {
                                    background-color: #f8f9fa; /* Bootstrap background color */
                                    padding: 20px;
                                }
                        
                                .form-label {
                                    font-weight: bold;
                                }
                        
                                .form-group {
                                    margin-bottom: 15px;
                                }
                        
                                .form-control {
                                    width: 100%;
                                    padding: 10px;
                                    box-sizing: border-box;
                                }
                        
                                .btn {
                                    padding: 10px 20px;
                                    font-size: 16px;
                                    cursor: pointer;
                                }
                        
                                .result-label {
                                    margin-top: 20px;
                                }
                            </style>
                        </head>
                        
                        <body>
                          {% comment %} {% if 'isLoggedin' not in request.session %}
                          <script>window.location.href = "/login/";</script>
                      {% endif %} {% endcomment %}
                            <form>
                            <div class="container">
                                <div class="form-group col-10 mb-1 mx-2 mt-4 mx-5">
                                    <label for="odNetPremium" class="form-label">OD/Net Premium<span class="text-danger">*</span></label>
                                    <input type="number" name="odNetPremium" id="odNetPremium" class="form-control" required>
                                </div>
                                <div class="form-group col-10 mb-1 mx-2 mt-4 mx-5">
                                    <label for="commissionPercentage" class="form-label">Commission %<span class="text-danger">*</span></label>
                                    <input type="number" name="commissionPercentage" id="commissionPercentage" class="form-control" required>
                                </div>
                                <button onclick="calculateProfit()" class="btn btn-success mb-1 mx-2 mt-4 mx-5">Calculate Profit</button>
                        
                                <div class="result-label col-10 mb-1 mx-2 mt-4 mx-5">
                                    <label for="profitResult" class="form-label">Profit</label>
                                    <input type="text" name="profitResult" id="profitResult" class="form-control" readonly>
                                </div>
                        
                                <div class="form-group mt-3 col-10 mb-1 mx-2 mt-4 mx-5">
                                  <label for="tdsPercentage" class="form-label">TDS %<span class="text-danger">*</span></label>
                                  <input type="number" name="tdsPercentage" id="tdsPercentage" class="form-control" required value="5" readonly>
                              </div>
                        
                                <button onclick="calculateProfitAfterTDS()" class="btn btn-success mb-1 mx-2 mt-4 mx-5">Calculate Profit After TDS</button>
                        
                                <div class="result-label col-10 mb-1 mx-2 mt-4 mx-5">
                                    <label for="profitAfterTDSResult" class="form-label">Profit After TDS:</label>
                                    <input type="text" name="profitAfterTDSResult" id="profitAfterTDSResult" class="form-control" readonly>
                                </div>
                        
                                <div class="form-group col-10 mb-1 mx-2 mt-4 mx-5">
                                    <label for="payoutDiscount" class="form-label">payoutDiscount<span class="text-danger">*</span></label>
                                    <input type="number" name="payoutDiscount" id="payoutDiscount" class="form-control" required>
                                </div>

                                <div class="form-group col-10 mb-1 mx-2 mt-4 mx-5">
                                  <label for="payoutDiscount" class="form-label">PayoutAmount<span class="text-danger">*</span></label>
                                  <input type="number" name="PayoutAmount" id="PayoutAmount" class="form-control" required>
                              </div>
                        
                                <button onclick="calculateNetProfit()" class="btn btn-success mb-1 mx-2 mt-4 mx-5">Calculate Net Profit</button>
                        
                                <div class="result-label col-10 mb-1 mx-2 mt-4 mx-5">
                                    <label for="netProfitResult" class="form-label">Net Profit:</label>
                                    <input type="text" name="netProfitResult" id="netProfitResult" class="form-control" readonly>
                                </div>
                        
                                <script>
                                  function allowChange() {
                                    var tdsInput = document.getElementById("tdsPercentage");
                                    // Check if the input field is empty or contains the default value
                                    if (tdsInput.value === "" || tdsInput.value === "5") {
                                        tdsInput.value = "5"; // Set default value to 5 if the field is empty or contains 5
                                    } else {
                                        // If the user has entered a different value, remove the readonly attribute
                                        tdsInput.removeAttribute("readonly");
                                    }
                                  }
                            
                                   // Add event listener to the input field
                                    document.getElementById("tdsPercentage").addEventListener("click", allowChange);

                                    function calculateProfit() {
                                        var odNetPremium = parseFloat(document.getElementById('odNetPremium').value);
                                        var commissionPercentage = parseFloat(document.getElementById('commissionPercentage').value);
                        
                                        if (!isNaN(odNetPremium) && !isNaN(commissionPercentage)) {
                                            var profit = (odNetPremium * commissionPercentage) / 100;
                                            document.getElementById('profitResult').value = profit.toFixed(2);
                                        } else {
                                            alert('Please enter valid numeric values for OD/Net Premium and Commission Percentage.');
                                        }
                                    }
                        
                                    function calculateProfitAfterTDS() {
                                        var profit = parseFloat(document.getElementById('profitResult').value);
                                        var tdsPercentage = parseFloat(document.getElementById('tdsPercentage').value);
                        
                                        if (!isNaN(profit) && !isNaN(tdsPercentage)) {
                                            var profitAfterTDS = profit - (profit * tdsPercentage / 100);
                                            document.getElementById('profitAfterTDSResult').value = profitAfterTDS.toFixed(2);
                                        } else {
                                            alert('Please enter valid numeric values for Profit and TDS Percentage.');
                                        }
                                    }
                        
                                    function calculateNetProfit() {
                                        var profitAfterTDS = parseFloat(document.getElementById('profitAfterTDSResult').value);
                                        var payoutDiscount = parseFloat(document.getElementById('payoutDiscount').value);
                        
                                        if (!isNaN(profitAfterTDS) && !isNaN(payoutDiscount)) {
                                            var netProfit = profitAfterTDS - payoutDiscount;
                                            document.getElementById('netProfitResult').value = netProfit.toFixed(2);
                                        } else {
                                            alert('Please enter valid numeric values for Profit After TDS and Payout/Discount.');
                                        }
                                    }
                                </script>
                            </div>
                        </body>
                        </html>
                        
                            <div class="col-10 mb-3 mx-4 mt-4 mx-5">
                                <label for="exampleInputEmail1" class="form-label">Executive <label>
                                <input type="text" name ='Executive' class="form-control" required >
                            </div>
                            <div class="col-10 mb-3 mx-4 mt-4 mx-5">
                                <label for="exampleInputtext" class="form-label">DSA/Reference <label>
                                <input type="text" name ='DSA' class="form-control" required >
                            </div>
                            <button type="submit" class="btn btn-primary">Submit</button>
                        </div>
                        </form>
                </div>
            </div>
        </div>
          
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Bootstrap Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>


    <br>
    <br>
    
    
      <center><h4 style="color: blue;">Data Records</h4></center>
      <table class="table table-bordered" id="dataRecords">
    <tr>
        <th style="border: 2px solid black;">Date</th>
        <th style="border: 2px solid black;">Name</th>
        <th style="border: 2px solid black;">Mobile</th>
        <th style="border: 2px solid black;">Policy Number</th>
        <th style="border: 2px solid black;">Vehicle Number</th>
        <th style="border: 2px solid black;">Vehicle</th>
        <th style="border: 2px solid black;">Location</th>
        <th style="border: 2px solid black;">HP Bank</th>
        <th style="border: 2px solid black;">Business Type</th>
        <th style="border: 2px solid black;">Insurance Type</th>
        <th style="border: 2px solid black;">Insurance Portal</th>
        <th style="border: 2px solid black;">Insurance Company</th>
        <th style="border: 2px solid black;">Payment</th>
        <th style="border: 2px solid black;">Payment SOS</th>
        <th style="border: 2px solid black;">Policy Start Date</th>
        <th style="border: 2px solid black;">Policy End Date</th>
        <th style="border: 2px solid black;">NCB</th>
        <th style="border: 2px solid black;">Premium</th>
        <th style="border: 2px solid black;">OD/Net Premium</th>
        <th style="border: 2px solid black;">Commission</th>
        <th style="border: 2px solid black;">Profit</th>
        <th style="border: 2px solid black;">TDS</th>
        <th style="border: 2px solid black;">Profit After TDS</th>
        <th style="border: 2px solid black;">Net Profit</th>
        <th style="border: 2px solid black;">Payout/Discount</th>
        <th style="border: 2px solid black;">Executive</th>
        <th style="border: 2px solid black;">DSA</th>
    </tr>
    {% for item in page_obj %}
    <tr>
        <td style="border: 2px solid black;">{{ item.date }}</td>
        <td style="border: 2px solid black;">{{ item.name }}</td>
        <td style="border: 2px solid black;">{{ item.number }}</td>
        <td style="border: 2px solid black;">{{ item.p_number }}</td>
        <td style="border: 2px solid black;">{{ item.v_number }}</td>
        <td style="border: 2px solid black;">{{ item.Vehicle }}</td>
        <td style="border: 2px solid black;">{{ item.Location }}</td>
        <td style="border: 2px solid black;">{{ item.HP_bank }}</td>
        <td style="border: 2px solid black;">{{ item.business_type }}</td>
        <td style="border: 2px solid black;">{{ item.insurance_type }}</td>
        <td style="border: 2px solid black;">{{ item.insurance_portal }}</td>
        <td style="border: 2px solid black;">{{ item.I_company }}</td>
        <td style="border: 2px solid black;">{{ item.payment }}</td>
        <td style="border: 2px solid black;">{{ item.payment_sos }}</td>
        <td style="border: 2px solid black;">{{ item.PS_date }}</td>
        <td style="border: 2px solid black;">{{ item.PE_date }}</td>
        <td style="border: 2px solid black;">{{ item.Ncb }}</td>
        <td style="border: 2px solid black;">{{ item.Premium }}</td>
        <td style="border: 2px solid black;">{{ item.odNetPremium }}</td>
        <td style="border: 2px solid black;">{{ item.commissionPercentage }}</td>
        <td style="border: 2px solid black;">{{ item.tdsPercentage }}</td>
        <td style="border: 2px solid black;">{{ item.profit_after_tds }}</td>
        <td style="border: 2px solid black;">{{ item.profit }}</td>
        <td style="border: 2px solid black;">{{ item.netProfitResult }}</td>
        <td style="border: 2px solid black;">{{ item.payoutDiscount }}</td>
        <td style="border: 2px solid black;">{{ item.Executive }}</td>
        <td style="border: 2px solid black;">{{ item.DSA }}</td>
    </tr>
    {% endfor %}
</table>
<script>
    function searchPhoneNumber() {
        var input, filter, table, tr, td, i, txtValue;
        input = document.getElementById("searchInput");
        filter = input.value.toUpperCase();
        table = document.getElementById("dataRecords");
        tr = table.getElementsByTagName("tr");
        for (i = 0; i < tr.length; i++) {
          td = tr[i].getElementsByTagName("td")[2]; // Change index to match the column where phone numbers are displayed
          if (td) {
            txtValue = td.textContent || td.innerText;
            if (txtValue.toUpperCase().indexOf(filter) > -1) {
              tr[i].style.display = "";
            } else {
              tr[i].style.display = "none";
            }
          }
        }
      }
</script>
<script>
    function downloadDataRecords() {
        // Get the table
        var table = document.getElementById("dataRecords");
        var rows = table.querySelectorAll("tr");
        
        // Initialize CSV string
        var csv = [];
        
        // Iterate over rows and columns to build CSV
        for (var i = 0; i < rows.length; i++) {
            var row = [], cols = rows[i].querySelectorAll("td, th");
            for (var j = 0; j < cols.length; j++) {
                // Remove any commas from the content to prevent CSV formatting issues
                var content = cols[j].innerText.replace(/,/g, "");
                row.push(content);
            }
            // Join row elements into a string and add to CSV
            csv.push(row.join(","));
        }
        
        // Combine rows into a single CSV string
        var csvString = csv.join("\n");
        
        // Create a blob containing the CSV data
        var blob = new Blob([csvString], { type: "text/csv;charset=utf-8;" });
        
        // Create a download link
        var link = document.createElement("a");
        if (link.download !== undefined) { // Feature detection
            // Set download link attributes
            var url = URL.createObjectURL(blob);
            link.setAttribute("href", url);
            link.setAttribute("download", "data_records.csv");
            
            // Append link to the body
            document.body.appendChild(link);
            
            // Trigger the download
            link.click();
            
            // Remove the link from the body
            document.body.removeChild(link);
        } else {
            alert("Your browser does not support downloading files.");
        }
    }
</script>
<div class="pagination">
  <span class="step-links">
      {% if page_obj.has_previous %}
          <a href="?page=1">&laquo; first</a>
          <a href="?page={{ page_obj.previous_page_number }}">previous</a>
      {% endif %}

      <span class="current">
          Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
      </span>

      {% if page_obj.has_next %}
          <a href="?page={{ page_obj.next_page_number }}">next</a>
          <a href="?page={{ page_obj.paginator.num_pages }}">last &raquo;</a>
      {% endif %}
  </span>
</div>

</body>
</html>





